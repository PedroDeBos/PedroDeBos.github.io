<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="SQL | Portfolio Pedro de Bos" />
<meta property="og:type" content="book" />







<meta name="description" content="SQL | Portfolio Pedro de Bos">

<title>SQL | Portfolio Pedro de Bos</title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.23/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<!--bookdown:toc:end-->
<!--bookdown:toc:start-->
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="sql" class="section level1">
<h1>SQL</h1>
<body id="start">
<div class="topnav">
<p><a href='index.html#Frontpage'>Frontpage</a>
<a href='data-visualisation.html#data-visualisation'>Data visualisation</a>
<a href='parametized-data-germany.html#parametized-data'>Parametizing data</a>
<a href='directory-structure.html#directory-structure'>Directory structure</a>
<a href='creating-a-r-package.html#creating-a-r-package'>R-package</a>
<a class="active" href='sql.html#SQL'>SQL</a>
<a href='bibliography-using-zotero.html#Bibliography using Zotero'>Zotero</a>
<a href='open-reproductibility-analysis.html#open-reproductibility-analysis'>Reproductibility</a>
<a href='future-endeavours.html#future-endeavours'>Future endeavours</a>
<a href='free-research-project-index.html#free-research-project'> Free research (Machine learning)</a>
<a href='cv.html#cv'>CV</a>
<a href='bibliography.html#bibliography'>Bibliography</a></p>
</div>
<p> </p>
<p>In order to prove my skills in the field of data handling and SQL, this page will show me work with flu data, dengue data and the gapminder data from the {dslabs} package. The flu data and dengue data are both supplied by google, “www.google.org/flutrends AND www.google.org/denguetrends”</p>
<p>First of all, all datasets will be read and inspected in R</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="sql.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The gapminder dataset</span></span>
<span id="cb40-2"><a href="sql.html#cb40-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##               country year infant_mortality life_expectancy fertility population          gdp continent          region
## 1             Albania 1960           115.40           62.87      6.19    1636054           NA    Europe Southern Europe
## 2             Algeria 1960           148.20           47.50      7.65   11124892  13828152297    Africa Northern Africa
## 3              Angola 1960           208.00           35.98      7.32    5270844           NA    Africa   Middle Africa
## 4 Antigua and Barbuda 1960               NA           62.97      4.43      54681           NA  Americas       Caribbean
## 5           Argentina 1960            59.87           65.39      3.11   20619075 108322326649  Americas   South America
## 6             Armenia 1960               NA           66.86      4.55    1867396           NA      Asia    Western Asia</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="sql.html#cb42-1" aria-hidden="true" tabindex="-1"></a>dengue<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;./data.raw/dengue_data.csv&quot;</span>, <span class="at">skip =</span> <span class="dv">10</span>)</span>
<span id="cb42-2"><a href="sql.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#The dengue dataset</span></span>
<span id="cb42-3"><a href="sql.html#cb42-3" aria-hidden="true" tabindex="-1"></a>dengue <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##         Date Argentina Bolivia Brazil India Indonesia Mexico Philippines Singapore Thailand Venezuela
## 1 2002-12-29        NA   0.101  0.073 0.062     0.101     NA          NA     0.059       NA        NA
## 2 2003-01-05        NA   0.143  0.098 0.047     0.039     NA          NA     0.059       NA        NA
## 3 2003-01-12        NA   0.176  0.119 0.051     0.059  0.071          NA     0.238       NA        NA
## 4 2003-01-19        NA   0.173  0.170 0.032     0.039  0.052          NA     0.175       NA        NA
## 5 2003-01-26        NA   0.146  0.138 0.040     0.112  0.048          NA     0.164       NA        NA
## 6 2003-02-02        NA   0.160  0.202 0.038     0.049  0.041          NA     0.163       NA        NA</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="sql.html#cb44-1" aria-hidden="true" tabindex="-1"></a>flu<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;./data.raw/flu_data.csv&quot;</span>, <span class="at">skip =</span> <span class="dv">10</span>)</span>
<span id="cb44-2"><a href="sql.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#The flu dataset</span></span>
<span id="cb44-3"><a href="sql.html#cb44-3" aria-hidden="true" tabindex="-1"></a>flu <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Date<span class="sc">:</span>Japan) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co">#Selected till Japan for a cleaner table</span></span></code></pre></div>
<pre><code>##         Date Argentina Australia Austria Belgium Bolivia Brazil Bulgaria Canada Chile France Germany Hungary Japan
## 1 2002-12-29        NA        NA      NA      NA      NA    174       NA     NA    NA     NA      NA      NA    NA
## 2 2003-01-05        NA        NA      NA      NA      NA    162       NA     NA    NA     NA      NA      NA    NA
## 3 2003-01-12        NA        NA      NA      NA      NA    174       NA     NA     1     NA      NA      NA    NA
## 4 2003-01-19        NA        NA      NA      NA      NA    162       NA     NA     0     NA      NA      NA    NA
## 5 2003-01-26        NA        NA      NA      NA      NA    131       NA     NA     0     NA      NA      NA    NA
## 6 2003-02-02       136        NA      NA      NA      NA    151       NA     NA     0     NA      NA      NA    NA</code></pre>
<p>Both the flu and the dengue datasets are not tidy: Each row contains the incidence rate (observation) of dengue/flu of multiple countries, while each row is only supposed to have 1 observation. The datasets will be wrangled to be tidy</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="sql.html#cb46-1" aria-hidden="true" tabindex="-1"></a>dengue_tidy<span class="ot">&lt;-</span>dengue <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Argentina<span class="sc">:</span>Venezuela,</span>
<span id="cb46-2"><a href="sql.html#cb46-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">names_to =</span> <span class="st">&quot;country&quot;</span>,</span>
<span id="cb46-3"><a href="sql.html#cb46-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values_to =</span> <span class="st">&quot;dengue_incidence&quot;</span>)</span>
<span id="cb46-4"><a href="sql.html#cb46-4" aria-hidden="true" tabindex="-1"></a>dengue_tidy <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   Date       country   dengue_incidence
##   &lt;chr&gt;      &lt;chr&gt;                &lt;dbl&gt;
## 1 2002-12-29 Argentina           NA    
## 2 2002-12-29 Bolivia              0.101
## 3 2002-12-29 Brazil               0.073
## 4 2002-12-29 India                0.062
## 5 2002-12-29 Indonesia            0.101
## 6 2002-12-29 Mexico              NA</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="sql.html#cb48-1" aria-hidden="true" tabindex="-1"></a>flu_tidy<span class="ot">&lt;-</span>flu <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Argentina<span class="sc">:</span>Uruguay,</span>
<span id="cb48-2"><a href="sql.html#cb48-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">names_to =</span> <span class="st">&quot;country&quot;</span>,</span>
<span id="cb48-3"><a href="sql.html#cb48-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values_to =</span> <span class="st">&quot;flu_incidence&quot;</span>)</span>
<span id="cb48-4"><a href="sql.html#cb48-4" aria-hidden="true" tabindex="-1"></a>flu_tidy <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   Date       country   flu_incidence
##   &lt;chr&gt;      &lt;chr&gt;             &lt;int&gt;
## 1 2002-12-29 Argentina            NA
## 2 2002-12-29 Australia            NA
## 3 2002-12-29 Austria              NA
## 4 2002-12-29 Belgium              NA
## 5 2002-12-29 Bolivia              NA
## 6 2002-12-29 Brazil              174</code></pre>
<p>Now the data is tidy, however, to make the dengue/flu data relational, the “date” data needs to be properly synchronized. To do this, the “date” will be split into “year”, “month” and “day”. These will be changed from character vectors to integers</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="sql.html#cb50-1" aria-hidden="true" tabindex="-1"></a>flu_separate<span class="ot">&lt;-</span>flu_tidy <span class="sc">%&gt;%</span> <span class="fu">separate</span>(<span class="at">col =</span> Date, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>))</span>
<span id="cb50-2"><a href="sql.html#cb50-2" aria-hidden="true" tabindex="-1"></a>flu_separate<span class="sc">$</span>year<span class="ot">&lt;-</span>flu_separate<span class="sc">$</span>year <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()</span>
<span id="cb50-3"><a href="sql.html#cb50-3" aria-hidden="true" tabindex="-1"></a>flu_separate<span class="sc">$</span>month<span class="ot">&lt;-</span>flu_separate<span class="sc">$</span>month <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()</span>
<span id="cb50-4"><a href="sql.html#cb50-4" aria-hidden="true" tabindex="-1"></a>flu_separate<span class="sc">$</span>day<span class="ot">&lt;-</span>flu_separate<span class="sc">$</span>day <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()</span>
<span id="cb50-5"><a href="sql.html#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="sql.html#cb50-6" aria-hidden="true" tabindex="-1"></a>dengue_separate<span class="ot">&lt;-</span>dengue_tidy <span class="sc">%&gt;%</span> <span class="fu">separate</span>(<span class="at">col =</span> Date, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>))</span>
<span id="cb50-7"><a href="sql.html#cb50-7" aria-hidden="true" tabindex="-1"></a>dengue_separate<span class="sc">$</span>year<span class="ot">&lt;-</span>dengue_separate<span class="sc">$</span>year <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()</span>
<span id="cb50-8"><a href="sql.html#cb50-8" aria-hidden="true" tabindex="-1"></a>dengue_separate<span class="sc">$</span>month<span class="ot">&lt;-</span>dengue_separate<span class="sc">$</span>month <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()</span>
<span id="cb50-9"><a href="sql.html#cb50-9" aria-hidden="true" tabindex="-1"></a>dengue_separate<span class="sc">$</span>day<span class="ot">&lt;-</span>dengue_separate<span class="sc">$</span>day <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()</span></code></pre></div>
<p>Now, with the data properly relational, it’ll be written into .csv’s and .rds’</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="sql.html#cb51-1" aria-hidden="true" tabindex="-1"></a>flu_separate <span class="sc">%&gt;%</span> <span class="fu">write.csv</span>(<span class="at">file =</span> <span class="st">&quot;./data/flu.csv&quot;</span>)</span>
<span id="cb51-2"><a href="sql.html#cb51-2" aria-hidden="true" tabindex="-1"></a>flu_separate <span class="sc">%&gt;%</span> <span class="fu">write_rds</span>(<span class="at">file =</span> <span class="st">&quot;./data/flu.rds&quot;</span>)</span>
<span id="cb51-3"><a href="sql.html#cb51-3" aria-hidden="true" tabindex="-1"></a>dengue_separate <span class="sc">%&gt;%</span> <span class="fu">write.csv</span>(<span class="at">file =</span> <span class="st">&quot;./data/dengue.csv&quot;</span>)</span>
<span id="cb51-4"><a href="sql.html#cb51-4" aria-hidden="true" tabindex="-1"></a>dengue_separate <span class="sc">%&gt;%</span> <span class="fu">write_rds</span>(<span class="at">file =</span> <span class="st">&quot;./data/dengue.rds&quot;</span>)</span>
<span id="cb51-5"><a href="sql.html#cb51-5" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">write.csv</span>(<span class="at">file =</span> <span class="st">&quot;./data/gapminder.csv&quot;</span>)</span>
<span id="cb51-6"><a href="sql.html#cb51-6" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">write_rds</span>(<span class="at">file =</span> <span class="st">&quot;./data/gapminder.rds&quot;</span>)</span></code></pre></div>
<p>Using the SQL script shown in the screenshot below, a SQL database has been created called “workflowsdb”.</p>
<p><img src="images/SQL_1.png"></p>
<p>Using RPostgreSQL, the created datasets will be inserted into this database</p>
<p>(Creating a connection with SQL requires a password: in order to prevent the leakage of my password, the local RDS datafiles created above have been used instead of using the datafiles from an SQL database. The code which would be used <em>if</em> I were to use my password will still be shown)</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="sql.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">&quot;R/login_credentials.R&quot;</span>))</span>
<span id="cb52-2"><a href="sql.html#cb52-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RPostgres<span class="sc">::</span><span class="fu">Postgres</span>(),</span>
<span id="cb52-3"><a href="sql.html#cb52-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dbname =</span> <span class="st">&quot;workflowsdb&quot;</span>,</span>
<span id="cb52-4"><a href="sql.html#cb52-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">host =</span> <span class="st">&quot;localhost&quot;</span>, </span>
<span id="cb52-5"><a href="sql.html#cb52-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">port =</span> <span class="dv">5432</span>,</span>
<span id="cb52-6"><a href="sql.html#cb52-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">user=</span> <span class="st">&quot;postgres&quot;</span>,</span>
<span id="cb52-7"><a href="sql.html#cb52-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">password =</span> <span class="fu">rawToChar</span>(pwd))</span>
<span id="cb52-8"><a href="sql.html#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="sql.html#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">&quot;gapminder&quot;</span>, gapminder)</span>
<span id="cb52-10"><a href="sql.html#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">&quot;dengue&quot;</span>, dengue_separate)</span>
<span id="cb52-11"><a href="sql.html#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">&quot;flu&quot;</span>, flu_separate)</span></code></pre></div>
<p>To inspect the database in order to check if all data has been transfered correctly, another SQL script has been used. Once again, screenshots of this script have been added underneath.</p>
<p><img src="images/SQL_2.png"></p>
<p><img src="images/SQL_3.png"></p>
<p>For further insurance, the data will also be inspected via R</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="sql.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">&quot;R/login_credentials.R&quot;</span>))</span>
<span id="cb53-2"><a href="sql.html#cb53-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RPostgres<span class="sc">::</span><span class="fu">Postgres</span>(),</span>
<span id="cb53-3"><a href="sql.html#cb53-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dbname =</span> <span class="st">&quot;workflowsdb&quot;</span>,</span>
<span id="cb53-4"><a href="sql.html#cb53-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">host =</span> <span class="st">&quot;localhost&quot;</span>, </span>
<span id="cb53-5"><a href="sql.html#cb53-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">port =</span> <span class="dv">5432</span>,</span>
<span id="cb53-6"><a href="sql.html#cb53-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">user=</span> <span class="st">&quot;postgres&quot;</span>,</span>
<span id="cb53-7"><a href="sql.html#cb53-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">password =</span> <span class="fu">rawToChar</span>(pwd))</span>
<span id="cb53-8"><a href="sql.html#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="sql.html#cb53-9" aria-hidden="true" tabindex="-1"></a>gapminder<span class="ot">&lt;-</span><span class="fu">dbReadTable</span>(con, <span class="st">&quot;gapminder&quot;</span>)</span>
<span id="cb53-10"><a href="sql.html#cb53-10" aria-hidden="true" tabindex="-1"></a>dengue<span class="ot">&lt;-</span><span class="fu">dbReadTable</span>(con, <span class="st">&quot;dengue&quot;</span>)</span>
<span id="cb53-11"><a href="sql.html#cb53-11" aria-hidden="true" tabindex="-1"></a>flu<span class="ot">&lt;-</span><span class="fu">dbReadTable</span>(con, <span class="st">&quot;flu&quot;</span>)</span></code></pre></div>
<p>We want to join the datasets based on “year” and on “countries”, thus we shall inspect those character vectors in partciular</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="sql.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="at">gapminder_years=</span>gapminder<span class="sc">$</span>year <span class="sc">%&gt;%</span> <span class="fu">unique</span>(),</span>
<span id="cb54-2"><a href="sql.html#cb54-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">dengue_years=</span>dengue<span class="sc">$</span>year <span class="sc">%&gt;%</span> <span class="fu">unique</span>(),</span>
<span id="cb54-3"><a href="sql.html#cb54-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">flu_years=</span>flu<span class="sc">$</span>year <span class="sc">%&gt;%</span> <span class="fu">unique</span>())</span></code></pre></div>
<pre><code>## $gapminder_years
##  [1] 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987 1988 1989 1990
## [32] 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016
## 
## $dengue_years
##  [1] 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015
## 
## $flu_years
##  [1] 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015</code></pre>
<p>Based on the years, we can state that dengue and flu share the same range of years, while gapminder has a way bigger range of years it covers</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="sql.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="at">gapminder_countries=</span>gapminder<span class="sc">$</span>country <span class="sc">%&gt;%</span> unique <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">50</span>),</span>
<span id="cb56-2"><a href="sql.html#cb56-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">dengue_countries=</span>dengue<span class="sc">$</span>country <span class="sc">%&gt;%</span> unique,</span>
<span id="cb56-3"><a href="sql.html#cb56-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">flu_countries=</span>flu<span class="sc">$</span>country <span class="sc">%&gt;%</span> unique)</span></code></pre></div>
<pre><code>## $gapminder_countries
##  [1] Albania                  Algeria                  Angola                   Antigua and Barbuda      Argentina                Armenia                 
##  [7] Aruba                    Australia                Austria                  Azerbaijan               Bahamas                  Bahrain                 
## [13] Bangladesh               Barbados                 Belarus                  Belgium                  Belize                   Benin                   
## [19] Bhutan                   Bolivia                  Bosnia and Herzegovina   Botswana                 Brazil                   Brunei                  
## [25] Bulgaria                 Burkina Faso             Burundi                  Cambodia                 Cameroon                 Canada                  
## [31] Cape Verde               Central African Republic Chad                     Chile                    China                    Colombia                
## [37] Comoros                  Congo, Dem. Rep.         Congo, Rep.              Costa Rica               Cote d&#39;Ivoire            Croatia                 
## [43] Cuba                     Cyprus                   Czech Republic           Denmark                  Djibouti                 Dominican Republic      
## [49] Ecuador                  Egypt                   
## 185 Levels: Albania Algeria Angola Antigua and Barbuda Argentina Armenia Aruba Australia Austria Azerbaijan Bahamas Bahrain Bangladesh Barbados ... Zimbabwe
## 
## $dengue_countries
##  [1] &quot;Argentina&quot;   &quot;Bolivia&quot;     &quot;Brazil&quot;      &quot;India&quot;       &quot;Indonesia&quot;   &quot;Mexico&quot;      &quot;Philippines&quot; &quot;Singapore&quot;   &quot;Thailand&quot;    &quot;Venezuela&quot;  
## 
## $flu_countries
##  [1] &quot;Argentina&quot;     &quot;Australia&quot;     &quot;Austria&quot;       &quot;Belgium&quot;       &quot;Bolivia&quot;       &quot;Brazil&quot;        &quot;Bulgaria&quot;      &quot;Canada&quot;        &quot;Chile&quot;        
## [10] &quot;France&quot;        &quot;Germany&quot;       &quot;Hungary&quot;       &quot;Japan&quot;         &quot;Mexico&quot;        &quot;Netherlands&quot;   &quot;New.Zealand&quot;   &quot;Norway&quot;        &quot;Paraguay&quot;     
## [19] &quot;Peru&quot;          &quot;Poland&quot;        &quot;Romania&quot;       &quot;Russia&quot;        &quot;South.Africa&quot;  &quot;Spain&quot;         &quot;Sweden&quot;        &quot;Switzerland&quot;   &quot;Ukraine&quot;      
## [28] &quot;United.States&quot; &quot;Uruguay&quot;</code></pre>
<p>In the countries, we can see a way wider spread of countries. Gapminder contains data of over 180 countries (only the top 50 are shown), while flu has 30 and dengue has 10. In order to create a full, properly joined dataset we will filter all 3 datasets to only contain shared years and shared countries</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="sql.html#cb58-1" aria-hidden="true" tabindex="-1"></a>dengue_countries<span class="ot">&lt;-</span>dengue<span class="sc">$</span>country <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb58-2"><a href="sql.html#cb58-2" aria-hidden="true" tabindex="-1"></a>dengue_flu_countries<span class="ot">&lt;-</span>flu<span class="sc">$</span>country <span class="sc">%&gt;%</span> <span class="fu">str_extract</span>(<span class="at">pattern =</span> dengue_countries) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="co">#Filtering for countries which </span></span>
<span id="cb58-3"><a href="sql.html#cb58-3" aria-hidden="true" tabindex="-1"></a>                                                                                      <span class="co">#are present in both dengue and flu</span></span>
<span id="cb58-4"><a href="sql.html#cb58-4" aria-hidden="true" tabindex="-1"></a>dengue_flu_countries<span class="ot">&lt;-</span>dengue_flu_countries[<span class="sc">!</span><span class="fu">is.na</span>(dengue_flu_countries)] <span class="co">#Filtering for NA&#39;s</span></span>
<span id="cb58-5"><a href="sql.html#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="sql.html#cb58-6" aria-hidden="true" tabindex="-1"></a>gapminder<span class="sc">$</span>country <span class="sc">%&gt;%</span> <span class="fu">str_subset</span>(<span class="at">pattern =</span> dengue_flu_countries) <span class="sc">%&gt;%</span> unique </span></code></pre></div>
<pre><code>## [1] &quot;Argentina&quot; &quot;Brazil&quot;    &quot;Mexico&quot;    &quot;Bolivia&quot;</code></pre>
<p>Based on these filters, the for countries available in every dataset are: Argentina, Brazil, Mexico, Bolivia</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="sql.html#cb60-1" aria-hidden="true" tabindex="-1"></a>flu_year<span class="ot">&lt;-</span>flu<span class="sc">$</span>year</span>
<span id="cb60-2"><a href="sql.html#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="sql.html#cb60-3" aria-hidden="true" tabindex="-1"></a>gapminder_join<span class="ot">&lt;-</span>gapminder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="fu">max</span>(flu_year) <span class="sc">&amp;</span> year <span class="sc">&gt;=</span><span class="fu">min</span>(flu_year)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-4"><a href="sql.html#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> dengue_flu_countries)</span>
<span id="cb60-5"><a href="sql.html#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="sql.html#cb60-6" aria-hidden="true" tabindex="-1"></a>data_full<span class="ot">&lt;-</span><span class="fu">left_join</span>(gapminder_join, dengue, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-7"><a href="sql.html#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(flu, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>))</span></code></pre></div>
<p>Now, with this fully joined dataset filtered for both mutual countries and years, some visualisations will be performed</p>
<p>Firstly, dengue incidence in 4 countries over 15 years</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="sql.html#cb61-1" aria-hidden="true" tabindex="-1"></a>data_sum_dengue<span class="ot">&lt;-</span>data_full <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(country, year) <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="sql.html#cb61-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(dengue_incidence, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;country&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="sql.html#cb63-1" aria-hidden="true" tabindex="-1"></a>data_sum_dengue <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>mean))<span class="sc">+</span></span>
<span id="cb63-2"><a href="sql.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> country))<span class="sc">+</span></span>
<span id="cb63-3"><a href="sql.html#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> country))<span class="sc">+</span></span>
<span id="cb63-4"><a href="sql.html#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb63-5"><a href="sql.html#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">&quot;Dengue incidence over 12 years in 4 countries&quot;</span>,</span>
<span id="cb63-6"><a href="sql.html#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x=</span><span class="st">&quot;Time in years&quot;</span>,</span>
<span id="cb63-7"><a href="sql.html#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">&quot;incidence (unit not mentioned)&quot;</span></span>
<span id="cb63-8"><a href="sql.html#cb63-8" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb63-9"><a href="sql.html#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Secondly, the incidence of flue through the months in the 4 different countries</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="sql.html#cb64-1" aria-hidden="true" tabindex="-1"></a>month_data<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb64-2"><a href="sql.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">month=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>),</span>
<span id="cb64-3"><a href="sql.html#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">MONTH=</span><span class="fu">c</span>(<span class="st">&quot;January&quot;</span>, <span class="st">&quot;Februari&quot;</span>, <span class="st">&quot;March&quot;</span>, <span class="st">&quot;April&quot;</span>, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;June&quot;</span>, <span class="st">&quot;July&quot;</span>, </span>
<span id="cb64-4"><a href="sql.html#cb64-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;August&quot;</span>, <span class="st">&quot;September&quot;</span>, <span class="st">&quot;October&quot;</span>, <span class="st">&quot;November&quot;</span>, <span class="st">&quot;December&quot;</span>)</span>
<span id="cb64-5"><a href="sql.html#cb64-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-6"><a href="sql.html#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="sql.html#cb64-7" aria-hidden="true" tabindex="-1"></a>month_data<span class="sc">$</span>MONTH<span class="ot">&lt;-</span><span class="fu">factor</span>(month_data<span class="sc">$</span>MONTH, <span class="at">levels =</span><span class="fu">c</span>(<span class="st">&quot;January&quot;</span>, <span class="st">&quot;Februari&quot;</span>, <span class="st">&quot;March&quot;</span>, <span class="st">&quot;April&quot;</span>, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;June&quot;</span>, <span class="st">&quot;July&quot;</span>, </span>
<span id="cb64-8"><a href="sql.html#cb64-8" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">&quot;August&quot;</span>, <span class="st">&quot;September&quot;</span>, <span class="st">&quot;October&quot;</span>, <span class="st">&quot;November&quot;</span>, <span class="st">&quot;December&quot;</span>))</span>
<span id="cb64-9"><a href="sql.html#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="sql.html#cb64-10" aria-hidden="true" tabindex="-1"></a>data_month<span class="ot">&lt;-</span><span class="fu">left_join</span>(data_full, month_data, <span class="at">by=</span><span class="st">&quot;month&quot;</span>)</span>
<span id="cb64-11"><a href="sql.html#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="sql.html#cb64-12" aria-hidden="true" tabindex="-1"></a>data_month <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>MONTH, <span class="at">y=</span>flu_incidence))<span class="sc">+</span></span>
<span id="cb64-13"><a href="sql.html#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill=</span>country), <span class="at">position =</span> <span class="fu">position_dodge</span>())<span class="sc">+</span></span>
<span id="cb64-14"><a href="sql.html#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb64-15"><a href="sql.html#cb64-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">&quot;Flu incidence by month in 4 countries&quot;</span>,</span>
<span id="cb64-16"><a href="sql.html#cb64-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x=</span><span class="st">&quot;Month&quot;</span>,</span>
<span id="cb64-17"><a href="sql.html#cb64-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">&quot;Incidence (unit not mentioned)&quot;</span></span>
<span id="cb64-18"><a href="sql.html#cb64-18" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb64-19"><a href="sql.html#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb64-20"><a href="sql.html#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>And finally, a correlation between dengue incidence and flu incidence? (Spoiler: no. Not at all.)</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="sql.html#cb65-1" aria-hidden="true" tabindex="-1"></a>correlation<span class="ot">&lt;-</span><span class="fu">cor.test</span>(data_full<span class="sc">$</span>dengue_incidence, data_full<span class="sc">$</span>flu_incidence, <span class="at">method=</span><span class="fu">c</span>(<span class="st">&quot;pearson&quot;</span>))<span class="sc">$</span>estimate <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="sql.html#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb65-3"><a href="sql.html#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="sql.html#cb65-4" aria-hidden="true" tabindex="-1"></a>data_full <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>flu_incidence, <span class="at">y=</span>dengue_incidence))<span class="sc">+</span></span>
<span id="cb65-5"><a href="sql.html#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>country), <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb65-6"><a href="sql.html#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb65-7"><a href="sql.html#cb65-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">&quot;Correlation between flu incidence and dengue incidence&quot;</span>,</span>
<span id="cb65-8"><a href="sql.html#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">&quot;Flu incidence (unit not mentioned)&quot;</span>,</span>
<span id="cb65-9"><a href="sql.html#cb65-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">&quot;Dengue incidence (unit not mentioned&quot;</span></span>
<span id="cb65-10"><a href="sql.html#cb65-10" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb65-11"><a href="sql.html#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="dv">2600</span>, <span class="at">y=</span><span class="fl">0.95</span>, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&quot;Pearson&#39;s correlation: </span><span class="sc">\n</span><span class="st">&quot;</span>, correlation))<span class="sc">+</span></span>
<span id="cb65-12"><a href="sql.html#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>

</div>
<p style="text-align: center;">
<a href="creating-a-r-package.html"><button class="btn btn-default">Previous</button></a>
<a href="bibliography-using-zotero.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
